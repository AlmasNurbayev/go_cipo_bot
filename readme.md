# GO_CIPO_BOT

Суть - Телеграм-бот и источник данных - хранилище транзакций с KOFD

# Основные сервисы

- Postgres в стандартном контейнере
- KOFD_UPDATER - парсер данных с внешнего API KOFD и сохранение в БД
- BANK_UPDATER - парсер данных с Google Sheets и сохранение в БД
- BOT - интерфейс для доступа к данным в виде телеграм-бота

# Пакеты планируемые для использования

- [go-telegram] (github.com/go-telegram/bot)
- pgx / pgxpool / scany
- github.com/golang-migrate/migrate

# TODO

- [v] 2025-05-14 получили токен, теперь надо получить операции
- [v] 2025-05-15 записываем в БД транзакции полученные из КОФД, но нужно получить и записать в БД информацию из чека, названия, путь до картинки
- [v] 2025-07-19 заменить пакет для telegram api на более документированный https://github.com/go-telegram/bot
- [v] 2025-07-19 kofd_updater вставку операций делать обернуть в транзакцию Postrges, транзакцию создать в его main.go
- [v] в GetGoodsFromCheque - отпарсить из чека не только имена, но и кол-во, цены
- [v] поле cheque в БД поменять тип на JSON или связанную таблицу "Товары в транзакциях"
- [v] 2027-07-24 - BOT - запросить URL-картинки по name_1c к бэкенду сайта. Открытый вопрос - хранить ли URL в базе данных, так как 1С может менять имя файла
- [v] 2027-07-24 поле cheque в БД - также парсить секцию Скидки, добавить поля в cheque_json
- [v] 2025-07-20 - BOT - вывод по кнопке "Все чеки" по итогам дня или недели
- [v] 2025-07-26 - KOFD_updater - при каждом обновлении помещать новые операции в Кафку/RMQ
- [v] 2025-07-26 - BOT - читать новые операции из Кафки/RMQ
- [v] 2025-08-09 - BOT - выводить отдельные чеки с картинками
- [ ] 2025-08-09 - BOT - в GetPeriodByMode добавить вариант получения даты по шаблону 2025-08-21, для получения итогов по любому дню
- [ ] 2025-08-09 - BOT/updater - заменить Kafka на Nats
- [ ] 2025-08-10 - если в сервисе getAllChecks сообщение превысит лимит в 4096 символа, то нужно разбить на части, а не отказывать. Но суммарно не более 50 чеков
